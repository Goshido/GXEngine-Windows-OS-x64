#version 330 core


#define VELOCITY_SLOT		0
#define EPSILON				0.001
#define MINIMUM_BLUR		0.5


smooth in vec2 v_uv;

uniform sampler2D velocityViewSampler;
uniform float explosureTime;
uniform float maxBlurSamples;

layout ( location = VELOCITY_SLOT ) out vec2 outVelocity;


void main ()
{
	vec2 alpha = 0.5 * texture ( velocityViewSampler, v_uv ).xy * explosureTime;
	float betta = length ( alpha );
	float gamma = max ( MINIMUM_BLUR, min ( betta, maxBlurSamples ) );
	outVelocity = ( alpha * gamma ) / ( betta + EPSILON );
}
